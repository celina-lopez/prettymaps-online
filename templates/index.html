{% extends "layout.html" %}
{% block body %}

<div class="container py-5 mb-3 content" x-data="{}">
  <div class="text-end mb-4">
    <div style="font-size: 2em; cursor: pointer;" x-on:click="location.href='https://github.com/czhu12/forever-free-cloud-app-starter'">
      <i class="fab fa-github"></i>
    </div>
  </div>
  <div class="text-center mb-4">
    <div class="h1 text-center fancy-font">
      PRETTYMAPS <span class="text-main">ONLINE</span>
    </div>
    <i>Made with prettymaps + forever free cloud app starter</i>
  </div>
  <p>
  {{ readme | safe }}
  </p>

  <div class="d-grid gap-2">
  
    <div class="row">
      <div class="col-md-6">
        <label for="xCoord">x</label>
        <input type="number" name="x" step="any" class="form-control" id="x" placeholder="37.7767135">
      </div>
      <div class="col-md-6">
        <label for="yCoord">x</label>
        <input type="number" name="y" step="any" class="form-control" id="y" placeholder="-122.4353989">
      </div>
    </div>
      <label for="mapName">Name</label>
      <input type="text" name="name" class="form-control" id="mapName" placeholder="Painted Ladies">

      <label for="theme">Theme</label>
      <select class="form-control" id="theme_num" name="theme_num">
        <option selected value="0">Kawaii</option>
        <option value="1">One</option>
        <option value="2">Two</option>
        <option value="3">Three</option>
        <option value="4">Three</option>
        <option value="5">Three</option>
      </select>
      <button id="urlSubmit" class="btn btn-main btn-lg btn-block">
        Generate Image
      </button>
    <div class="row justify-content-center mt-3">
      <div class="col-auto">
        <div id="display" style="max-width: 500px;">
          <img src="" id="imgHere" width="500" class="rounded" />
          <div class="d-flex justify-content-center">
            <div class="spinner-border d-none" id="imageSpinner" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="footer-copyright text-center py-3">
  <i>This was built with <a target="_blank" href="https://forever-free-cloud-app-starter.chriszhu.me/">Forever-Free Cloud App Starter</a></i>
</div>

<script>
  document.getElementById("urlSubmit").addEventListener("click", function () {
    document.getElementById("imageSpinner").setAttribute("class", "spinner-border")
    let request = new XMLHttpRequest();
    queryString = "?name=" + document.getElementById("mapName").value + "&x=" + document.getElementById("x").value + "&y=" + document.getElementById("y").value + "&theme_num" + document.getElementById("theme_num").value
    request.open('GET', "/api" + queryString);
    request.responseType = 'text';
    request.onload = function() {
      const text = request.response.slice(1, -1);
      document.getElementById("imgHere").setAttribute("src", "data:image/png;base64," + text);
      document.getElementById("imageSpinner").setAttribute("class", "spinner-border d-none");
    };
    request.send()
  });

</script>


{% endblock %}
